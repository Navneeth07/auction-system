;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="b1e0ca32-9840-ff5d-0788-2bc7b241b722")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6855136,e=>{e.v({avatar:"group-module__Dj5yHG__avatar",group:"group-module__Dj5yHG__group",note:"group-module__Dj5yHG__note",noteText:"group-module__Dj5yHG__noteText"})},7609806,e=>{"use strict";var t=e.i(4205214),r=e.i(9722978),i=e.i(8660982),s=e.i(1344973),a=e.i(4585051),n=e.i(6855136),l=e.i(3025777),o=e.i(3896588),c=e.i(6683690);let d=(0,i.memo)(e=>{let{member:r,size:i,showIcon:s,iconBackground:n,lazy:d=!1}=e;return"teamId"in r?(0,t.jsx)(a.Avatar,{lazy:d,size:i,teamId:r.teamId,title:r.teamName},r.teamId):r.githubUser?(0,t.jsx)("span",{title:r.name,children:(0,t.jsx)(l.GitHubAvatar,{iconBackground:n,lazy:d,showIcon:s,size:i,username:r.username})},r.username):r.gitlabUser?(0,t.jsx)("span",{title:r.name,children:(0,t.jsx)(o.GitLabAvatar,{iconBackground:n,lazy:d,showIcon:s,size:i,url:r.url})},r.username):r.bitbucketUser?(0,t.jsx)("span",{title:r.name,children:(0,t.jsx)(c.BitbucketAvatar,{iconBackground:n,lazy:d,showIcon:s,size:i,url:r.url})},r.username):r.username?(0,t.jsx)(a.Avatar,{size:i,username:r.username},r.username):r.url?(0,t.jsx)(a.Avatar,{size:i,url:r.url},r.url):(0,t.jsx)(a.Avatar,{size:i,uid:r.uid},r.uid)});d.displayName="GroupAvatar";let u=e=>{let{members:i,limit:a=3,extra:l=0,size:o=24,showIcon:c=!1,iconBackground:u=!0,ariaHidden:p,lazy:m=!1}=e;0===a&&(a=i.length),a-=1;let g=i.slice(0,a),x=i.slice(a),h=x.length+l,f=h>9?"9+":`+${h}`,j=`${h} more avatars in this group`;return(0,t.jsxs)("div",{"aria-hidden":p,className:n.default.group,children:[g.map(e=>(0,t.jsx)("span",{className:n.default.avatar,children:"component"in e?e.component:(0,t.jsx)(d,{member:e,size:o,showIcon:c,iconBackground:u,lazy:m})},"teamId"in e?e.teamId:e.uid||e.username||e.url)),x.length||l>0?(0,t.jsxs)("span",{"aria-label":j,className:(0,r.clsx)(n.default.note,{[n.default.avatar||""]:x.length}),title:j,children:[x.length?"component"in x[0]?x[0].component:(0,t.jsx)(d,{member:x[0],size:o,showIcon:c,iconBackground:u,lazy:m}):null,h>1?(0,t.jsx)(s.Text,{as:"span",className:(0,r.clsx)(n.default.noteText,"dark-theme"),color:"gray-1000",size:10,weight:600,children:f}):null]}):null]})};u.displayName="AvatarGroup";let p=(0,i.memo)(u);e.s(["AvatarGroup",0,p])},4535059,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)(`<g stroke="currentColor" stroke-width="1.5" fill="none">
    <path d="M4.75 0.75H2.75C1.64543 0.75 0.75 1.64543 0.75 2.75V4.75" stroke-linecap="square"/>
    <path d="M11.25 15.25H13.25C14.3546 15.25 15.25 14.3546 15.25 13.25V11.25" stroke-linecap="square"/>
    <path d="M11.25 0.75H13.25C14.3546 0.75 15.25 1.64543 15.25 2.75V4.75" stroke-linecap="square"/>
    <path d="M4.75 15.25H2.75C1.64543 15.25 0.75 14.3546 0.75 13.25V11.25" stroke-linecap="square"/>
    <path d="M4.5 5H9.5" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7.5 8L12.5 8" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4.5 11H9.5" stroke-linecap="round" stroke-linejoin="round"/>
  </g>`);e.s(["Traces",0,t])},6695099,e=>{"use strict";var t=e.i(8660982),r={};e.s(["default",0,function(e){for(var i=arguments.length,s=Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];var n=[],l=[],o=function(e){var i=(0,t.createContext)(r);n.push(i),l.push(function(){return(0,t.useContext)(i)})};return s.length?s.forEach(function(e){return o(e.name)}):o(e.name),[function(r){for(var i=r.children,a=e(function(e,t){if(null==e)return{};var r,i,s={},a=Object.keys(e);for(i=0;i<a.length;i++)t.indexOf(r=a[i])>=0||(s[r]=e[r]);return s}(r,["children"])),l=i,o=0;o<n.length;o+=1){var c=n[o],d=s[o]||function(e){return e};l=(0,t.createElement)(c.Provider,{value:d(a)},l)}return l}].concat(l)}])},9861498,e=>{e.v({button:"custom-module__vVV9Vq__button"})},7668531,e=>{"use strict";var t=e.i(4205214),r=e.i(9722978),i=e.i(9861498),s=e.i(7602961);e.s(["CustomButtonLink",0,e=>{let{normal:a,active:n,hover:l,className:o,...c}=e;return(0,t.jsx)(s.ButtonLink,{...c,className:(0,r.clsx)(i.default.button,o),"data-custom-button":"",style:{"--button-custom-fg":`${a?.foreground||""}`,"--button-custom-bg":`${a?.background||""}`,"--button-custom-border":`${a?.border||""}`,"--button-custom-fg-active":`${n?.foreground||""}`,"--button-custom-bg-active":`${n?.background||""}`,"--button-custom-border-active":`${n?.border||""}`,"--button-custom-fg-hover":`${l?.foreground||""}`,"--button-custom-bg-hover":`${l?.background||""}`,"--button-custom-border-hover":`${l?.border||""}`},children:c.children})}])},2470467,e=>{e.v({description:"description-module__J9KQsG__description",ellipsis:"description-module__J9KQsG__ellipsis",icon:"description-module__J9KQsG__icon",right:"description-module__J9KQsG__right"})},4245131,e=>{"use strict";var t=e.i(4205214),r=e.i(8660982),i=e.i(9722978),s=e.i(2988836),a=e.i(5468328),n=e.i(2470467);let l=(0,r.memo)(function(e){let{title:r,content:l,tooltip:o,right:c,className:d,ellipsis:u,"data-testid":p,tooltipProps:m}=e;return(0,t.jsxs)("dl",{className:(0,i.clsx)(n.default.description,{[String(n.default.right)]:c,[String(n.default.ellipsis)]:u},d),"data-testid":p,"data-version":"v1",children:[(0,t.jsxs)("dt",{"data-geist-description-title":"",children:[r,o?(0,t.jsx)("span",{className:n.default.icon,children:(0,t.jsx)(a.Tooltip,{text:o,...m,children:(0,t.jsx)(s.InformationFillSmall,{size:14})})}):null]}),(0,t.jsx)("dd",{"data-geist-description-content":"",children:l})]})});e.s(["Description",0,l])},4819890,e=>{"use strict";let t=(0,e.i(9334638).withNewIcon)('<path fill="#666" fill-rule="evenodd" d="M14.5 8a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0ZM16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0ZM6 11l5.5-3L6 5v6Z" clip-rule="evenodd" style="fill:currentColor;"/>');e.s(["PlayCircle",0,t])},2098824,e=>{"use strict";var t=e.i(4205214);e.s(["FormTitleDescription",0,function(e){let{title:r,description:i,as:s,htmlFor:a}=e;return(0,t.jsxs)(t.Fragment,{children:["label"===s?(0,t.jsx)("label",{htmlFor:a,className:"text-[14px] leading-[20px] font-medium text-inherit",children:r}):(0,t.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-inherit",children:r}),(0,t.jsx)("p",{className:"text-[14px] font-light leading-[20px] mt-1.5",children:i})]})}])},1087959,e=>{"use strict";var t=e.i(4205214),r=e.i(6226725),i=e.i(2504781),s=e.i(5255926),a=e.i(4004502),n=e.i(6048771);e.s(["ProjectSelectItem",0,function(e){let{project:s,onRemove:l,disabled:o}=e;return(0,t.jsxs)("div",{className:"py-3 px-2 flex flex-row justify-between border border-gray-200 border-t-0 first:border-t first:rounded-t-[6px] last:rounded-b-[6px]","data-testid":(0,a.tid)("project-selected","item"),children:[(0,t.jsxs)("div",{className:"flex flex-col @lg-page:flex-row items-start @lg-page:items-center justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(n.ProjectLogo,{deploymentId:s.latestDeployments?.[s.latestDeployments.length-1]?.id,framework:s.framework,project:s,size:20}),(0,t.jsx)("p",{className:"font-medium text-sm text-gray-1000",children:s.name})]}),(0,t.jsx)("p",{className:"text-copy-14 text-gray-900",children:s.targets?.production?.alias?.[0]})]}),l&&!o?(0,t.jsx)(i.Button,{className:"p-0 [&>span]:p-0 flex items-center justify-center","aria-label":"Remove project",shape:"circle",size:"tiny",type:"tertiary",style:{width:20,height:20},svgOnly:!0,typeName:"button",onClick:()=>l(s.id),children:(0,t.jsx)(r.CrossCircle,{size:16})}):null]},s.id)},"ProjectSelectItemSkeleton",0,function(){return(0,t.jsxs)("div",{className:"py-3 px-2 flex flex-row justify-between border border-gray-200 border-t-0 first:border-t first:rounded-t-[6px] last:rounded-b-[6px]",children:[(0,t.jsxs)("div",{className:"flex flex-col @lg-page:flex-row items-start @lg-page:items-center justify-start gap-2 flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,t.jsx)(s.Skeleton,{width:20,height:20,boxHeight:20,rounded:!0}),(0,t.jsx)(s.Skeleton,{width:180,height:14})]}),(0,t.jsx)(s.Skeleton,{width:120,height:12})]}),(0,t.jsx)(s.Skeleton,{width:20,height:20,rounded:!0})]})}])},2565125,e=>{"use strict";var t,r=e.i(4205214),i=e.i(1848296),s=e.i(3917098),a=e.i(2098824),n=e.i(1087959),l=e.i(6401841),o=((t={}).ALL="all",t.SOME="some",t);function c(e){let{count:t=2}=e;return 0===t?null:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"",children:Array.from({length:t}).map((e,t)=>(0,r.jsx)(n.ProjectSelectItemSkeleton,{},t))})})}function d(e){let{error:t}=e;return t?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(l.Stop,{size:14,color:"red-700"}),(0,r.jsx)("p",{className:"text-copy-14 text-red-900",children:t})]}):null}e.s(["ProjectSelector",0,function(e){let{error:t,projects:l,projectType:o,onProjectTypeUpdated:u,onProjectsUpdated:p,title:m,description:g,disabled:x,isLoading:h,loadingCount:f,comboboxListContainer:j,disableAllProjects:y,allProjectsComponent:v}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,r.jsx)("div",{children:(0,r.jsx)(a.FormTitleDescription,{description:g,title:m})}),(0,r.jsx)(i.RadioGroup,{disabled:x,onChange:e=>u(e),value:o,children:(0,r.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-6 flex-initial",children:[(0,r.jsx)(i.RadioGroup.Item,{value:"all",disabled:y,children:v||"All Projects"}),(0,r.jsx)(i.RadioGroup.Item,{value:"some",children:"Specific Projects"})]})})]}),"some"===o&&(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:[(0,r.jsx)(s.ProjectSelect,{errored:!!t,disabled:x,onSelect:e=>{p([...l,e])},selected:l,verifyIntegrationsPermissions:!1,comboboxListContainer:j}),h?(0,r.jsx)(c,{count:f}):l.length?(0,r.jsx)("div",{children:l.map(e=>(0,r.jsx)(n.ProjectSelectItem,{disabled:x,onRemove:e=>p(l.filter(t=>t.id!==e)),project:e},e.id))}):null]}),(0,r.jsx)(d,{error:t})]})},"ProjectTypes",()=>o])},3186231,e=>{"use strict";var t=e.i(5677444),r=e.i(8660982),i=e.i(7722264),s=e.i(6352514),a=e.i(1853611),n=e.i(8042625),l=e.i(277234),o=e.i(4244280),c=e.i(4418317),d=e.i(9125947);e.s(["useInstallIntegrationPopup",0,function(e){let{integration:u,source:p,onSuccess:m,onError:g}=e,x=(0,t.useRouter)(),h=(0,t.useSearchParams)(),f=(0,r.useRef)(null),j=async e=>{let t,r,{account:x,projects:j,additionalQueryParameters:y={}}=e;if(f.current)return void f.current.open();let v=`${window.location.origin}/integrations/${u.slug}/loading`,b="datastax-astra-db"===u.slug||u.slug?.includes("aws")||"slack"===u.slug,N=!1,I=null,w=!1,S=x&&"slug"in x?x:void 0,T=x&&"username"in x?x:void 0,C=h?.get("state"),k=async e=>{let{configuration:t,team:r}=e;return a.analytics.track(s.AnalyticsEvent.INTEGRATION_POPUP_INSTALL_FINISHED,{source:p,target:S?"team":"personal-account",integration:{id:u.id,slug:u.slug}}),a.analytics.track(s.AnalyticsEvent.INTEGRATIONS_INSTALL_MODAL_SUCCESS,{source:p}),a.analytics.track(s.AnalyticsEvent.INTEGRATION_INSTALLED,{integration_id:u.id,integration_slug:u.slug,source:p,target:S?"team":"personal-account"}),a.analytics.track(s.AnalyticsEvent.INTEGRATION_INSTALL_SUCCEEDED,{source:p,target:S?"team":"personal-account",integration:{id:u.id,slug:u.slug}}),m({configuration:t,team:r})},_=async e=>{let{id:t,team:r}=e;(await (0,l.fetchAPI)(`${o.API_INTEGRATION_CONTROLLER}/configuration/${t}${(0,n.encode)({teamId:r?.id})}`)).completedAt||await (0,l.fetchAPI)(`${o.API_INTEGRATION_CONTROLLER}/configuration/${t}${(0,n.encode)({teamId:r?.id})}`,{method:"DELETE"})};f.current=new c.default({id:`install-integration:${u.slug}:${Math.random().toString(36).slice(2)}`,url:v,callbacks:{onOpen:()=>{b&&(N=!1),g?.({message:void 0})},onBlocked:()=>{f.current=null,g?.({message:"The installation could not be started."}),a.analytics.track(s.AnalyticsEvent.INTEGRATION_POPUP_INSTALL_BLOCKED,{source:p,target:S?"team":"personal-account"})},onPoll:async e=>{if(N||e.location.href!==v){if(I&&!I.completedAt)try{let e=await (0,l.fetchAPI)(`${o.API_INTEGRATION_CONTROLLER}/configuration/${I.id}${(0,n.encode)({teamId:S?.id})}`,{method:"GET"});e.completedAt&&(I=e)}catch(e){g?.((0,i.isError)(e)?e:{message:"Something went wrong."}),f.current?.close();return}}else{N=!0,a.analytics.track(s.AnalyticsEvent.INTEGRATION_POPUP_INSTALL_STARTED,{source:p,target:S?"team":"personal-account",integration:{id:u.id,slug:u.slug}});try{let e=await (0,l.fetchAPI)(`${o.API_INTEGRATION_CONTROLLER}/integration/${u.slug}/configuration${(0,n.encode)({teamId:S?.id})}`);"error"in e||(I=e);let t=await (0,l.fetchAPI)(I?`${o.API_INTEGRATION_CONTROLLER}/integration/${u.slug}/configuration/${I.id}${(0,n.encode)({teamId:S?.id})}`:`${o.API_INTEGRATION_CONTROLLER}/integration/${u.slug}/configuration${(0,n.encode)({teamId:S?.id})}`,{method:"POST",body:JSON.stringify({projects:j,source:p,scopes:u.scopes})});I||(w=!0,I=t.configuration),r=t.authorizationCode}catch(e){g?.((0,i.isError)(e)?e:{message:"Something went wrong."}),f.current?.close();return}t=`${window.location.origin}/${S?.slug||T?.username}/~/integrations/${I.id}/installed${b?"?autoclose=true":""}`,e.location.href=`${u.redirectUri}${(0,n.encode)({state:C,code:r,teamId:S?.id,configurationId:I.id,source:I.source,...y,next:t})}`}try{let r=!1;r=b?!!(N&&I?.completedAt):!!(N&&I&&e.location.origin+e.location.pathname===t),I&&r&&(f.current?.cancelPolling(),await (0,d.default)(2e3),await k({configuration:I,team:S}),f.current?.close())}catch(e){if(e instanceof DOMException&&"SecurityError"===e.name)return;throw e}},onClose:()=>{f.current=null},onAbort:async()=>{!b&&(f.current=null,g?.({message:"The installation was canceled."}),a.analytics.track(s.AnalyticsEvent.INTEGRATION_INSTALL_CANCELED,{source:p,target:S?"team":"personal-account",integration:{id:u.id,slug:u.slug}}),w&&I&&await _({id:I.id,team:S}))}}}),f.current.open()},y=async e=>{let t,{account:r,projects:c}=e,d=r&&"slug"in r?r:void 0;try{t=await (0,l.fetchAPI)(`${o.API_INTEGRATION_CONTROLLER}/integration/${u.slug}/configuration${(0,n.encode)({teamId:d?.id})}`,{method:"POST",body:JSON.stringify({projects:c,source:p,scopes:u.scopes})})}catch(e){g?.((0,i.isError)(e)?e:{message:"Something went wrong."});return}a.analytics.track(s.AnalyticsEvent.INTEGRATION_INSTALL_SUCCEEDED,{source:p,target:d?"team":"personal-account",integration:{id:u.id,slug:u.slug}});let{configuration:m}=t;x.push(`${window.location.origin}/dashboard/${d?`${d.slug}/`:""}integrations/${m.id}`)};return{open:e=>u.redirectUri?j(e):y(e),close:()=>{console.log("close called"),f.current?.close()}}}])},2454893,e=>{e.v({cardLink:"marketplace-integration-card-module__GWffEq__cardLink",descriptionWrapper:"marketplace-integration-card-module__GWffEq__descriptionWrapper",icon:"marketplace-integration-card-module__GWffEq__icon",integrationCard:"marketplace-integration-card-module__GWffEq__integrationCard"})},1282571,e=>{"use strict";var t=e.i(4205214),r=e.i(9722978),i=e.i(9739627),s=e.i(4585051),a=e.i(5255926),n=e.i(2504781),l=e.i(57106),o=e.i(2704354),c=e.i(2454893),d=e.i(5677444),u=e.i(397094);function p(e){let{icon:r,name:a,size:n=36}=e;return(0,o.isContentfulIcon)(r)?(0,t.jsx)("div",{className:c.default.icon,children:(0,t.jsx)(i.Image,{alt:a,height:n,srcDark:`https:${r.fields.file.url}`,srcLight:`https:${r.fields.file.url}`,width:n})}):(0,t.jsx)(s.Avatar,{className:c.default.icon,hash:r,size:n})}e.s(["MarketplaceIntegrationCard",0,function(e){let{Actions:i,children:s,href:a,title:n,icon:o,className:m,"data-testid":g,disabled:x}=e,h=(0,d.useRouter)();return(0,t.jsxs)("div",{className:(0,r.clsx)(m,c.default.integrationCard),children:[(0,t.jsxs)("div",{className:(0,r.clsx)("flex flex-row items-stretch justify-between gap-4 flex-initial",c.default.descriptionWrapper),children:[(0,t.jsxs)("div",{className:(0,r.clsx)("flex flex-row items-center justify-start gap-3 flex-initial",c.default.descriptionWrapper),children:[(0,t.jsx)(p,{icon:o,name:n}),s]}),i]}),x?null:(0,t.jsx)(l.Link,{"aria-label":`Open ${n}`,className:c.default.cardLink,"data-testid":g,href:a,onMouseDown:(0,u.buildOnMouseDown)({href:a,router:h})})]})},"MarketplaceIntegrationCardIcon",0,p,"MarketplaceIntegrationCardPlaceholder",0,function(e){let{children:i,Action:s,className:l}=e;return(0,t.jsx)("div",{className:(0,r.clsx)(l,c.default.integrationCard),children:(0,t.jsxs)("div",{className:"flex flex-row items-stretch justify-between flex-initial",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial w-full",children:[(0,t.jsx)(a.Skeleton,{height:36,rounded:!0,width:36}),i]}),s??(0,t.jsx)(n.Button,{size:"small",type:"secondary",children:(0,t.jsx)(a.Skeleton,{height:16,width:30})})]})})}])},4325157,e=>{"use strict";var t=e.i(850302),r=e.i(9411809);let i=(0,r.createServerReference)("7f90503781c0a3c400ad8877208208bc4e45c9c107",r.callServer,void 0,r.findSourceMapURL,"findManyPrivateMarketplaceIntegrationsByProduct");var s=e.i(2704354),a=e.i(9668517);e.s(["useMarketplaceIntegrations",0,e=>{let{protocolType:r}=e,n=(0,a.useTeamSlug)();return(0,t.default)(()=>(0,s.getMarketplaceIntegrationsApiUrl)({teamIdOrSlug:n??null,protocolType:r}),async e=>e&&n?i({protocolType:r,teamIdOrSlug:n}):[])}],4325157)},4110479,e=>{"use strict";var t=e.i(4205214),r=e.i(8660982);let i=(0,r.createContext)(null);e.s(["DrainModalProvider",0,e=>{let{children:s,initialResource:a}=e,[n,l]=(0,r.useState)(!1),[o,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(a),p=(0,r.useCallback)((e,t)=>{c(e),u(t),l(!0)},[]),m=(0,r.useCallback)(()=>{c(null),u(a),l(!1)},[a]),g=(0,r.useMemo)(()=>({isOpen:n,setIsOpen:l,drain:o,resource:d,openDrain:p,closeModal:m}),[n,o,d,m,p]);return(0,t.jsx)(i.Provider,{value:g,children:s})},"useDrainModalContext",0,()=>{let e=(0,r.useContext)(i);if(null===e)throw Error("useDrainModal must be used within a DrainModalProvider");return e},"useOptionalDrainModalContext",0,()=>(0,r.useContext)(i)])},9412123,e=>{"use strict";var t=e.i(7694836),r=function(e,r,i){if(e&&"reportValidity"in e){var s=(0,t.get)(i,r);e.setCustomValidity(s&&s.message||""),e.reportValidity()}},i=function(e,t){var i=function(i){var s=t.fields[i];s&&s.ref&&"reportValidity"in s.ref?r(s.ref,i,e):s.refs&&s.refs.forEach(function(t){return r(t,i,e)})};for(var s in t.fields)i(s)},s=function(e,r){r.shouldUseNativeValidation&&i(e,r);var s={};for(var a in e){var n=(0,t.get)(r.fields,a);(0,t.set)(s,a,Object.assign(e[a],{ref:n&&n.ref}))}return s},a=function(e,r){for(var i={};e.length;){var s=e[0],a=s.code,n=s.message,l=s.path.join(".");if(!i[l])if("unionErrors"in s){var o=s.unionErrors[0].errors[0];i[l]={message:o.message,type:o.code}}else i[l]={message:n,type:a};if("unionErrors"in s&&s.unionErrors.forEach(function(t){return t.errors.forEach(function(t){return e.push(t)})}),r){var c=i[l].types,d=c&&c[s.code];i[l]=(0,t.appendErrors)(l,r,i,a,d?[].concat(d,s.message):s.message)}e.shift()}return i};e.s(["zodResolver",0,function(e,t,r){return void 0===r&&(r={}),function(n,l,o){try{return Promise.resolve(function(s,a){try{var l=Promise.resolve(e["sync"===r.mode?"parse":"parseAsync"](n,t)).then(function(e){return o.shouldUseNativeValidation&&i({},o),{errors:{},values:r.rawValues?n:e}})}catch(e){return a(e)}return l&&l.then?l.then(void 0,a):l}(0,function(e){return{values:{},errors:e.isEmpty?{}:s(a(e.errors,!o.shouldUseNativeValidation&&"all"===o.criteriaMode),o)}}))}catch(e){return Promise.reject(e)}}}],9412123)},2199694,e=>{"use strict";e.s(["isCreateFlow",0,function(e){return"mode"in e&&"create"===e.mode},"isUpdateFlow",0,function(e){return"mode"in e&&"update"===e.mode}])},5263903,(e,t,r)=>{"use strict";let i="[a-fA-F\\d:]",s=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${i})|(?<=${i})(?=\\s|$))`:"",a="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",n="[a-fA-F\\d]{1,4}",l=`
(?:
(?:${n}:){7}(?:${n}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${n}:){6}(?:${a}|:${n}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${n}:){5}(?::${a}|(?::${n}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${n}:){4}(?:(?::${n}){0,1}:${a}|(?::${n}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${n}:){3}(?:(?::${n}){0,2}:${a}|(?::${n}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${n}:){2}(?:(?::${n}){0,3}:${a}|(?::${n}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${n}:){1}(?:(?::${n}){0,4}:${a}|(?::${n}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${n}){0,5}:${a}|(?::${n}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=RegExp(`(?:^${a}$)|(?:^${l}$)`),c=RegExp(`^${a}$`),d=RegExp(`^${l}$`),u=e=>e&&e.exact?o:RegExp(`(?:${s(e)}${a}${s(e)})|(?:${s(e)}${l}${s(e)})`,"g");u.v4=e=>e&&e.exact?c:RegExp(`${s(e)}${a}${s(e)}`,"g"),u.v6=e=>e&&e.exact?d:RegExp(`${s(e)}${l}${s(e)}`,"g"),t.exports=u},3775629,(e,t,r)=>{"use strict";let i=e.r(5263903),s=e.r(6881271);t.exports=e=>{e={strict:!0,...e};let t=`(?:(?:[a-z]+:)?//)${e.strict?"":"?"}`,r=i.v4().source,a=`(?:\\.${e.strict?"(?:[a-z\\u00a1-\\uffff]{2,})":`(?:${s.sort((e,t)=>t.length-e.length).join("|")})`})\\.?`,n=`(?:${t}|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${r}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*${a})(?::\\d{2,5})?(?:[/?#][^\\s"]*)?`;return e.exact?RegExp(`(?:^${n}$)`,"i"):RegExp(n,"ig")}},7662235,1094129,e=>{"use strict";var t=e.i(4205214),r=e.i(7694836),i=e.i(9957872),s=e.i(248550),a=e.i(4535059),n=e.i(4524395),l=e.i(2640326),o=e.i(6401841),c=e.i(8660982),d=e.i(3758860),u=e.i(4110479);let p=[{value:"logs",protocol:"logDrain",icon:s.Logs,title:"Logs",description:"Runtime, build and static logs"},{value:"traces",protocol:"traceDrain",icon:a.Traces,title:"Traces",description:"Distributed tracing data"},{value:"speed_insights",protocol:null,icon:n.StopwatchFast,title:"Speed Insights",description:"Performance metrics"},{value:"analytics",protocol:null,icon:l.Analytics,title:"Web Analytics",description:"Page views and custom events"}];e.s(["chooseDrainDataStep",0,{title:"Choose data to drain",component:function(){let{watch:e,setValue:s,resetField:a,register:n,clearErrors:l,formState:{errors:m}}=(0,r.useFormContext)(),g=(0,u.useOptionalDrainModalContext)(),x=g?.resource,h=e("drainType"),f=e("mode");return(0,c.useEffect)(()=>{n("drainType",{required:"required"})},[]),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.ChoiceboxGroup,{className:"pt-4",direction:"column",label:"Choose data type",type:"radio",value:h??"",onChange:e=>{s("drainType",e),l("drainType"),"create"!==f||x?(a("delivery.type"),a("delivery.endpoint")):(s("delivery.type","traces"===e?"otlphttp":"http"),s("delivery.endpoint","traces"===e?{traces:""}:"")),a("delivery.encoding"),a("filters.log.sources"),a("filters.deployment.environments")},children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:p.filter(e=>!x||e.protocol&&"integration"===x.type&&(0,d.isProtocolSupported)(x.product,e.protocol)).map(e=>{let r=e.icon;return(0,t.jsx)(i.ChoiceboxGroup.Item,{value:e.value,title:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(r,{size:16}),e.title]}),description:e.description},e.value)})})}),m.drainType?.message&&(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)(o.Stop,{size:14,color:"red-700"}),(0,t.jsx)("p",{className:"text-copy-14 text-red-900",children:m.drainType.message})]})]})},getFieldsToValidate:()=>["drainType"],getIsNextEnabled:()=>!0,getSuffix:function(e,r){if(r)return null;let i=(()=>{switch(e){case"traces":return"Traces";case"logs":return"Logs";case"analytics":return"Web Analytics";case"speed_insights":return"Speed Insights"}})();return(0,t.jsx)("span",{className:"text-copy-14 text-gray-900",children:i})}}],7662235),e.i(3512434);var m=e.i(9835407),g=e.i(3775629);let x=m.z.enum(["production","preview"]),h=m.z.object({type:m.z.literal("head_sampling"),env:m.z.union([x,m.z.literal("all")]).transform(e=>"all"===e?void 0:e).optional(),rate:m.z.number().min(0,"Sampling rate must be between 0 and 100%").max(1,"Sampling rate must be between 0 and 100%"),requestPath:m.z.string().optional().transform(e=>""===e?void 0:e)}),f=m.z.string().refine(e=>e.startsWith("https://"),{message:"URL must start with https://"}).refine(e=>(0,g.default)({exact:!0}).test(e),{message:"Must be a valid URL"}),j=m.z.object({type:m.z.literal("http"),endpoint:f,encoding:m.z.enum(["json","ndjson"]),headers:m.z.record(m.z.string()),secret:m.z.union([m.z.string(),m.z.object({kind:m.z.literal("INTEGRATION_SECRET")})]).optional(),compression:m.z.enum(["gzip","none"]).optional()}),y=m.z.object({type:m.z.literal("otlphttp"),endpoint:m.z.object({traces:f}),encoding:m.z.enum(["proto","json"]),headers:m.z.record(m.z.string()),secret:m.z.union([m.z.string(),m.z.object({kind:m.z.literal("INTEGRATION_SECRET")})]).optional()}),v=m.z.discriminatedUnion("type",[j,y]),b=m.z.enum(["lambda","edge","static","external","build","firewall","redirect"]),N=m.z.enum(["logs","traces","analytics","speed_insights"]),I=m.z.union([m.z.object({kind:m.z.literal("integration"),resourceId:m.z.string().optional(),integrationId:m.z.string().optional(),integrationConfigurationId:m.z.string().optional()}),m.z.object({kind:m.z.literal("self-served")})]),w=m.z.object({log:m.z.object({sources:m.z.array(b)}),deployment:m.z.object({environments:m.z.array(x)})}),S=m.z.object({name:m.z.string().trim().min(1,"Drain name is required"),projects:m.z.enum(["all","some"]),drainType:N,delivery:v.optional(),sampling:m.z.array(h).max(10,"You can configure up to 10 sampling rules").optional(),projectIds:m.z.array(m.z.string()).optional(),filters:w,source:I.optional(),mode:m.z.literal("create")}),T=m.z.object({name:m.z.string().trim().min(1,"Drain name is required").optional(),projects:m.z.enum(["all","some"]).optional(),drainType:N,delivery:v.optional(),sampling:m.z.array(h).optional(),projectIds:m.z.array(m.z.string()).optional(),status:m.z.enum(["enabled","disabled"]).optional(),filters:w.optional(),source:I.optional(),mode:m.z.literal("update")}),C=m.z.discriminatedUnion("mode",[S,T]).refine(e=>"some"!==e.projects||e.projectIds&&e.projectIds.length>0,{message:"At least one project must be selected when choosing specific projects",path:["projectIds"]}).refine(e=>"logs"!==e.drainType||Number(e.filters?.log?.sources.length)>0,{message:"At least one source must be selected when draining logs",path:["filters.log.sources"]});e.s(["DrainFormSchema",0,C,"httpUrl",0,f,"sourceLabelMap",0,{lambda:"Functions",edge:"Edge Functions",static:"Static Files",external:"Rewrites",build:"Builds",firewall:"Firewall",redirect:"Redirects"}],1094129)},1733572,e=>{"use strict";let t={logs:"Logs",traces:"Traces",analytics:"Web Analytics",speed_insights:"Speed Insights"};e.s(["getDrainType",0,function(e){return e.schemas?.trace?"traces":e.schemas?.analytics?"analytics":e.schemas?.speed_insights?"speed_insights":"logs"},"getDrainTypeLabel",0,function(e){return t[e]}])},3614887,9572009,8249103,3456281,4789955,5664328,e=>{"use strict";let t;var r=e.i(4205214),i=e.i(3500331),s=e.i(3869281),a=e.i(7048904),n=e.i(6401841),l=e.i(2565125),o=e.i(2098824),c=e.i(1094129),d=e.i(1733572),u=e.i(7694836),p=e.i(8660982),m=e.i(6060673);let g=(0,p.createContext)(null),x=()=>(0,p.useContext)(g);e.s(["SheetContainerContext",0,g,"useSheetContainer",0,x],9572009);var h=e.i(5323212),f=e.i(3169345),j=e.i(8161149),y=e.i(2504781),v=e.i(5468328),b=e.i(923772),N=e.i(5169576);function I(){let{register:e,watch:t,setValue:s,formState:{errors:a}}=(0,u.useFormContext)(),l=t("filters.deployment.environments"),o=0===l.length||2===l.length,c=Array.isArray(a.sampling)?a.sampling[0]?.rate?.message:void 0,{fields:d,append:p,remove:m}=(0,u.useFieldArray)({name:"sampling"});return(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,r.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Sampling"}),0===d.length?(0,r.jsx)("div",{className:"flex flex-col items-center justify-start gap-4 flex-initial mt-1.5",children:(0,r.jsx)(j.EmptyState.Root,{secondary:!0,title:"No sampling rules configured",description:"Configure rules to set sampling rates by environment or path prefix.",children:(0,r.jsx)(y.Button,{onClick:()=>p({type:"head_sampling",env:void 0,rate:1}),type:"secondary",typeName:"button",children:"Add Sampling Rule"})})}):(0,r.jsxs)(f.Table,{className:"border-separate border-spacing-0 mt-1.5",children:[(0,r.jsx)(f.Table.Header,{removeSpacing:!0,children:(0,r.jsxs)(f.Table.Row,{children:[(0,r.jsx)(f.Table.Head,{className:"border-t border-l rounded-tl border-solid border-gray-200 text-xs pl-4",children:"Environment"}),(0,r.jsx)(f.Table.Head,{className:"border-t border-solid border-gray-200 text-xs",children:"Rate"}),(0,r.jsx)(f.Table.Head,{className:"border-t border-solid border-gray-200 text-xs",children:(0,r.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-1 flex-initial",children:["Request Path Prefix",(0,r.jsx)(v.Tooltip,{text:"The prefix of the request path to sample or the entire request path",children:(0,r.jsx)(N.Information,{size:12,color:"gray-700"})})]})}),(0,r.jsx)(f.Table.Head,{className:"border-t border-r rounded-tr border-solid border-gray-200 text-xs"})]})}),(0,r.jsxs)(f.Table.Body,{className:"[&_td:first-child]:rounded-l-none [&_td:last-child]:rounded-r-none",children:[d.map((n,l)=>{let o=e(`sampling.${l}.env`);e(`sampling.${l}.rate`,{valueAsNumber:!0});let c=t(`sampling.${l}.rate`),d=Array.isArray(a.sampling)?a.sampling[l]?.rate?.message:void 0;return(0,r.jsxs)(f.Table.Row,{children:[(0,r.jsx)(f.Table.Cell,{className:"border-l border-b border-solid border-gray-200 rounded-none py-4 pl-4",children:(0,r.jsx)(h.Select,{size:"small",ref:o.ref,name:o.name,value:t(`sampling.${l}.env`)??"all",onChange:e=>{s(`sampling.${l}.env`,e.target.value)},selectClassName:"capitalize",children:(0,r.jsx)(w,{})})}),(0,r.jsx)(f.Table.Cell,{className:"border-b border-solid border-gray-200 rounded-none max-w-20 py-4",children:(0,r.jsx)(i.Input,{error:d,showErrorMessage:!1,className:"[&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",suffix:"%","aria-labelledby":`sampling-rate-${l}`,typeName:"number",min:"0",max:"100",step:"1",size:"small",defaultValue:"100",style:{width:"100px"},value:"number"==typeof c?`${100*c}`:c,onChange:e=>{let t=e.target.valueAsNumber;"number"!=typeof t||Number.isNaN(t)?s(`sampling.${l}.rate`,t,{shouldDirty:!0}):s(`sampling.${l}.rate`,t/100,{shouldDirty:!0})}})}),(0,r.jsx)(f.Table.Cell,{className:"border-b border-solid border-gray-200 rounded-none py-4",children:(0,r.jsx)(i.Input,{"aria-labelledby":`request-path-${l}`,placeholder:`/api/example-${l+1}`,...e(`sampling.${l}.requestPath`),size:"small"})}),(0,r.jsx)(f.Table.Cell,{className:"border-b border-r border-solid border-gray-200 rounded-none py-4",children:(0,r.jsx)(y.Button,{size:"small",type:"tertiary",onClick:()=>m(l),"aria-label":"Remove sampling config",children:(0,r.jsx)(b.Trash,{color:"gray-700",size:16})})})]},n.id)}),(0,r.jsx)(f.Table.Row,{children:(0,r.jsx)(f.Table.Cell,{colSpan:4,className:"border-b border-l border-r border-solid border-gray-200 !rounded-bl !rounded-br py-4 pl-4",children:(0,r.jsx)("div",{className:"flex flex-row items-stretch justify-start gap-1 flex-initial",children:(0,r.jsx)(v.Tooltip,{text:"You can configure up to 10 sampling rules",disableTriggers:d.length<10,className:"",children:(0,r.jsx)(y.Button,{onClick:()=>p({type:"head_sampling",env:o?"all":l[0],rate:1}),size:"small",type:"tertiary",disabled:d.length>=10,typeName:"button",children:"Add Sampling Rule"})})})})})]})]}),c&&(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,r.jsx)(n.Stop,{size:14,color:"red-700"}),(0,r.jsx)("p",{className:"text-copy-14 text-red-900",children:c})]})]})}function w(){let{watch:e}=(0,u.useFormContext)(),t=e("filters.deployment.environments");return 0===t.length||2===t.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("option",{value:"all",children:"All Environments"}),(0,r.jsx)("option",{value:"production",children:"Production"}),(0,r.jsx)("option",{value:"preview",children:"Preview"})]}):(0,r.jsx)(r.Fragment,{children:t.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})}var S=e.i(4597921);let T=["lambda","edge","static","external","build","firewall","redirect"];function C(){let{watch:e,setValue:t,register:i,formState:{errors:a}}=(0,u.useFormContext)(),n=e("filters.log.sources"),l=(0,p.useCallback)(e=>{n.includes(e)?t("filters.log.sources",n.filter(t=>t!==e),{shouldDirty:!0}):t("filters.log.sources",[...n,e],{shouldDirty:!0})},[n,t]);return(0,p.useEffect)(()=>{i("filters.log.sources",{required:"required"})},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,r.jsx)(o.FormTitleDescription,{description:"Logs from the selected sources will be forwarded to your drain. At least one must be selected.",title:"Sources"}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-3 @md-page:grid-cols-3",children:T.map(e=>(0,r.jsx)(s.Checkbox,{className:"cursor-pointer rounded-md border border-gray-200 p-3 hover:border-gray-300",checked:n.includes(e),onChange:()=>l(e),children:c.sourceLabelMap[e]},e))}),(0,r.jsx)(D,{error:a.filters?.log?.sources?.message})]}),(0,r.jsx)(E,{})]})}function k(){return(0,r.jsx)(r.Fragment,{})}function _(){let{setValue:e,watch:t,register:i}=(0,u.useFormContext)(),s=t("sampling",[{type:"head_sampling",rate:1}]);return(0,p.useEffect)(()=>{i("sampling")},[]),(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:[(0,r.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Sampling"}),(0,r.jsxs)("span",{style:{minWidth:30,fontSize:"12px"},children:[Math.round((s?.[0]?.rate??1)*100),"%"]}),(0,r.jsx)("div",{style:{maxWidth:"200px",flex:1},children:(0,r.jsx)(a.Slider,{max:100,min:1,onValueChange:t=>{e("sampling",[{type:"head_sampling",rate:t[0]/100}],{shouldDirty:!0})},value:[Math.round((s?.[0]?.rate??1)*100)]})})]}),(0,r.jsx)("p",{className:"text-copy-14 text-gray-900",children:"A percentage of data matching the sampling rate will be sent to your drain from the selected environments."})]})}function E(){let{watch:e,setValue:t,formState:{errors:i}}=(0,u.useFormContext)(),a=e("filters.deployment.environments"),n=(e,r)=>{r?t("filters.deployment.environments",[...a,e],{shouldDirty:!0}):t("filters.deployment.environments",a.filter(t=>t!==e),{shouldDirty:!0})};return(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,r.jsx)(o.FormTitleDescription,{description:"Select which environments to drain from.",title:"Environment"}),(0,r.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-6 flex-initial",children:[(0,r.jsx)(s.Checkbox,{checked:a.includes("production"),onChange:e=>{n("production",e.target.checked)},children:"Production"}),(0,r.jsx)(s.Checkbox,{checked:a.includes("preview"),onChange:e=>{n("preview",e.target.checked)},children:"Preview"})]}),(0,r.jsx)(D,{error:i.filters?.deployment?.environments?.message})]})}function D(e){let{error:t}=e;return t?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(n.Stop,{size:14,color:"red-700"}),(0,r.jsx)("p",{className:"text-copy-14 text-red-900",children:t})]}):null}e.s(["configureDrainStep",0,{title:"Configure the drain",component:function(){let{watch:e,setValue:t,register:s,clearErrors:a,formState:{errors:n}}=(0,u.useFormContext)(),o=e("drainType"),c="logs"===o||"traces"===o,g=(0,S.useServerFlag)("drains-advanced-sampling",!1)&&c,h=e("projects"),f=e("projectIds")||[],j=x();(0,p.useEffect)(()=>{s("projects",{required:"required"}),s("projectIds")},[]);let{data:y,isLoading:v}=(0,m.useProjects)(f.length>0?f:void 0),b=y||[],[N,w]=(0,p.useState)([]);return(0,r.jsx)("div",{className:"pt-4 max-w-2xl",children:(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,r.jsx)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial w-full",children:(0,r.jsx)(i.Input,{label:"Drain Name",id:"drain-name",placeholder:`My ${(0,d.getDrainTypeLabel)(o)} drain`,width:"100%",className:"flex-1",error:n.name?.message,...s("name")})}),(0,r.jsx)(l.ProjectSelector,{error:n.projects?.message||n.projectIds?.message,projects:b,projectType:"all"===h?l.ProjectTypes.ALL:l.ProjectTypes.SOME,onProjectsUpdated:e=>{t("projectIds",e.map(e=>e.id),{shouldDirty:!0}),a("projectIds"),w(e)},onProjectTypeUpdated:e=>{a("projectIds"),t("projects",e===l.ProjectTypes.ALL?"all":"some",{shouldDirty:!0}),e===l.ProjectTypes.ALL?(b.length>0&&w(b),t("projectIds",void 0,{shouldDirty:!0})):t("projectIds",(N.length>0?N:b).map(e=>e.id),{shouldDirty:!0})},title:"Projects",description:"Choose which projects should send data to the specified endpoint.",disabled:!1,isLoading:v&&0===b.length,loadingCount:f.length,comboboxListContainer:j}),"logs"===o&&(0,r.jsx)(C,{}),"traces"===o&&(0,r.jsx)(k,{}),g?(0,r.jsx)(I,{}):(0,r.jsx)(_,{})]})})},getFieldsToValidate:()=>["name","projects","projectIds","filters.log.sources","filters.deployment.environments","sampling"],getIsNextEnabled:()=>!0}],3614887);var $=e.i(1265647),A=e.i(4469437),z=e.i(9334091),P=e.i(1906681),L=e.i(2455417),O=e.i(8735244),M=e.i(6607601),R=e.i(8225664),F=e.i(198667),U=e.i(6318858),B=e.i(4819890),G=e.i(1933683),V=e.i(3973638);let q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",H=(t=(e,t)=>{if(e<0||e>65536)throw RangeError('The value of "size" is out of range. It must be >= 0 && <= 65536. Received '+e);var r=new Uint8Array(e);return(globalThis.crypto.getRandomValues(r),t)?(setTimeout(()=>t(null,r),0),new Uint8Array):r},e=>new Promise(async(r,i)=>{Number.isInteger(e)?e<=0?i(Error("You must supply a length integer greater than zero")):t(e,(e,s)=>{let a;if(e)return i(e);let n=[];for(let e=0;e<s.length;e++){for(a=s[e];a>248;)try{a=t(1)[0]}catch(e){i(e)}n.push(q[a%q.length])}r(n.join(""))}):i(TypeError("You must supply a length integer to `uid-promise`."))}));async function W(e){return H(e)}e.s(["generateSecret",0,W],8249103);var Y=e.i(8804984),K=e.i(6695099),J=e.i(277234),Q=e.i(5338940);function Z(e){if(!e)throw Error("Drain type is required");switch(e){case"logs":return{log:{version:"v1"}};case"traces":return{trace:{version:"v1"}};case"analytics":return{analytics:{version:"v1"}};case"speed_insights":return{speed_insights:{version:"v1"}}}}e.s(["getDrainTypeFromDrain",0,function(e){return e.schemas?.log?"logs":e.schemas?.trace?"traces":e.schemas?.analytics?"analytics":e.schemas?.speed_insights?"speed_insights":"logs"},"getSchemaForDrainType",0,Z],3456281);let[X,ee]=(0,K.default)(function(){let{team:e}=(0,Q.useTeam)(),[t,r]=(0,p.useState)({status:"idle"});return{validationState:t,validateEndpoint:async t=>{r({status:"validating"});try{let{delivery:i,drainType:s}=t,a=Z(s),n={type:i?.type||"http",endpoint:i?.endpoint||"",encoding:i?.encoding||"json",headers:i?.headers||{},...i?.secret&&{secret:i.secret}},l=await (0,J.fetchAPI)(`/v1/drains/test${e?.id?`?teamId=${e.id}`:""}`,{method:"POST",body:{schemas:a,delivery:n},returnStatus:!0,throwOnHTTPError:!1});if(l.status&&l.status>=200&&l.status<300&&l.body){let{status:e,statusCode:t}=l.body;if(e){if("success"===e)return r({status:"success",message:"Success: Your endpoint sent a 2xx status"}),!0;if("failure"===e){if(t)return r({status:"error",message:`Error: Your endpoint sent a ${t} status instead of 2xx, fix it and try again`}),!1;return r({status:"error",message:"Error: Your endpoint did not reply, fix it and try again"}),!1}}}return r({status:"error",message:"Unknown error, please contact support"}),!1}catch(e){return r({status:"error",message:"Unknown error, please contact support"}),!1}},resetValidation:()=>{r({status:"idle"})}}});function et(e){let{icon:t,onClick:i,successDuration:s=1e3,...a}=e,[n,l]=(0,p.useState)(!1),[o,c]=(0,p.useState)(!0),d=(0,p.useRef)(null),u=async()=>{c(!1),d.current&&clearTimeout(d.current),await i(),l(!0),d.current=setTimeout(()=>{l(!1)},s)};return(0,r.jsx)(y.Button,{...a,onClick:u,children:(0,r.jsxs)("div",{style:{position:"relative",height:16,width:16},children:[(0,r.jsx)("div",{className:`absolute inset-0 transition-all duration-150 ease-out ${o?"opacity-0 scale-50":!o&&n?"opacity-100 scale-100":"opacity-0 scale-50"}`,children:(0,r.jsx)(U.Check,{size:16})}),(0,r.jsx)("div",{className:`absolute inset-0 transition-all duration-150 ease-out ${o||!o&&!n?"opacity-100 scale-100":"opacity-0 scale-50"}`,children:t})]})})}e.s(["EndpointValidationProvider",0,X,"useEndpointValidationContext",0,ee],4789955);let er={http:[{value:"json",label:"JSON"},{value:"ndjson",label:"NDJSON"}],otlphttp:[{value:"json",label:"JSON"},{value:"proto",label:"Protobuf"}]},ei={input:e=>e?Object.entries(e).map(e=>{let[t,r]=e;return`${t}: ${r}`}).join("\n"):"",output(e,t,r){if(!e)return{};let i=e.split("\n").filter(e=>e.trim()),s=[],a=i.reduce((e,t,r)=>{let[i,...a]=t.split(":"),n=a.join(":"),l=es(i?.trim()||""),o=es(n?.trim()||"");return l&&o?e[l]=o:s.push(`Line ${r+1}: "${t}"`),e},{});return s.length>0?t("delivery.headers",{message:`Invalid header format: ${s.join(", ")}. Expected format: "Header-Name: Header-Value"`}):r("delivery.headers"),a}};function es(e){return e?e.replace(/""+/g,'"').replace(/''+/g,"'").replace(/^["']+|["']+$/g,""):e}e.s(["CustomEndpointEditor",0,function(){let e,t,s,{watch:a,setValue:l,register:o,setError:d,clearErrors:m,formState:{errors:g}}=(0,u.useFormContext)(),{validationState:x,validateEndpoint:f,resetValidation:j}=ee();(0,p.useEffect)(()=>()=>{m(),j()},[]);let b=a("delivery.headers"),N=a("delivery.type"),I=a("delivery.endpoint"),w=a("drainType"),[S,T]=(0,p.useState)(ei.input(b||{})),[C,k]=(0,p.useState)(S.length>0),[_,E]=(0,p.useState)(!1),D=a("delivery.secret");return"string"==typeof I?(e="https://your-endpoint.com/ingest",t="delivery.endpoint"):(e="https://your-otlp-endpoint.com/v1/traces",t="delivery.endpoint.traces"),(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial pt-4 max-w-2xl",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 @md-page:grid-cols-[3fr_1fr] @md-page:gap-2 @md-page:items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,r.jsx)(i.Input,{id:"drain-url",label:"URL",prefix:"POST",placeholder:e,width:"100%",...o(t,{onChange:()=>{j(),m(t)}})}),(0,r.jsx)(v.Tooltip,{desktopOnly:!0,text:"Send an example payload to your endpoint for testing",children:(0,r.jsx)(y.Button,{"aria-label":"Test endpoint",type:"secondary",typeName:"button",disabled:!(s="string"==typeof I?I:I?.traces)||!c.httpUrl.safeParse(s).success||x?.status==="validating",svgOnly:!0,onClick:()=>{f(a())},prefix:x?.status==="validating"?(0,r.jsx)(O.Spinner,{size:16}):(0,r.jsx)(B.PlayCircle,{size:16}),children:"Test"})})]}),(0,Y.get)(g,`${t}.message`)&&(0,r.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,r.jsx)(n.Stop,{size:14,color:"red-700"}),(0,r.jsx)("p",{className:"text-copy-14 text-red-900",children:(0,Y.get)(g,`${t}.message`)})]}),x&&"idle"!==x.status&&(0,r.jsx)("div",{className:"mt-2 flex items-center gap-2",children:"validating"===x.status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.LoadingDots,{}),(0,r.jsx)("p",{className:"text-copy-13 text-gray-900",children:"Validating endpoint"})]}):(0,r.jsxs)(r.Fragment,{children:["success"===x.status?(0,r.jsx)(U.Check,{size:14,color:"green-700"}):(0,r.jsx)(n.Stop,{size:14,color:"red-700"}),(0,r.jsx)("p",{className:`text-copy-13 ${"success"===x.status?"text-green-900":"text-red-900"}`,children:x.message})]})})]}),(0,r.jsx)(h.Select,{label:"Encoding",placeholder:"Select encoding",...o("delivery.encoding"),children:er[N].map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]}),w&&(0,r.jsxs)("div",{className:"text-xs text-gray-900 text-right @md-page:text-right @sm-page:text-left",children:["Need help with the data format?"," ",(0,r.jsxs)("a",{href:{logs:"/docs/drains/reference/logs",traces:"/docs/drains/reference/traces",speed_insights:"/docs/drains/reference/speed-insights",analytics:"/docs/drains/reference/analytics"}[w],target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:["View"," ","speed_insights"===w?"Speed Insights":"analytics"===w?"Analytics":w.charAt(0).toUpperCase()+w.slice(1)," ","schema â†’"]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,r.jsx)(i.Input,{label:(0,r.jsxs)(r.Fragment,{children:["Signature verification secret"," ",(0,r.jsxs)("span",{className:"text-gray-900 normal-case",children:["(optional,"," ",(0,r.jsx)("a",{href:"/docs/drains/security",target:"_blank",rel:"noopener noreferrer",className:"text-gray-900 hover:text-gray-700 underline",children:"How to use it"})]}),")"]}),id:"drain-secret",placeholder:"32-character secret",width:"100%",className:"font-mono tracking-wider",typeName:_?"text":"password",prefix:(0,r.jsx)(y.Button,{"aria-label":"Toggle password visibility",variant:"unstyled",svgOnly:!0,typeName:"button",onClick:()=>E(!_),className:"-ml-1",children:_?(0,r.jsx)(V.EyeOff,{size:16}):(0,r.jsx)(G.Eye,{size:16})}),prefixStyling:!1,suffix:(0,r.jsx)(R.CopyButton,{textToCopy:"string"==typeof D?D:"",label:"Copy secret",title:"Copy secret to clipboard",disabled:"string"!=typeof D||!D,variant:"unstyled",className:"-mr-1"}),suffixStyling:!1,...o("delivery.secret")}),(0,r.jsx)(et,{"aria-label":"Generate new secret",shape:"square",svgOnly:!0,type:"secondary",typeName:"button",icon:(0,r.jsx)(F.RefreshClockwise,{size:16}),onClick:async()=>{l("delivery.secret",await W(32),{shouldDirty:!0})}})]})}),(0,r.jsx)("div",{className:"flex flex-row items-center justify-start gap-3 flex-initial",children:(0,r.jsx)(P.Toggle,{checked:C,id:"custom-headers",onChange:k,size:"medium",direction:"switch-first",children:(0,r.jsx)("p",{className:"text-copy-14",children:"Custom Headers"})})}),(0,r.jsx)(A.AnimatePresence,{initial:!1,children:C&&(0,r.jsx)($.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut",opacity:{duration:.2}},children:(0,r.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-3 flex-initial",children:(0,r.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-2 flex-initial",children:[(0,r.jsx)(z.Textarea,{error:(0,Y.get)(g,"delivery.headers.message"),"aria-labelledby":"Custom Headers (Optional)",className:"font-mono",onBlur:()=>{l("delivery.headers",ei.output(S,d,m),{shouldDirty:!0})},onChange:e=>T(e.target.value),placeholder:"Authorization: Bearer token X-Custom-Header: value",rows:3,value:S}),(0,r.jsxs)("p",{className:"text-copy-13 text-gray-900",children:["Format: Header-Name: Header-Value (one per line). The"," ",(0,r.jsx)(M.InlineCode,{children:"content-type"})," header is automatically added."]})]})})})})]})}],5664328)},4576858,3226981,4758962,e=>{"use strict";var t=e.i(4205214),r=e.i(8660982),i=e.i(4237893),s=e.i(6064230),a=e.i(762896),n=e.i(7694836),l=e.i(5664328);e.i(6887680);var o=e.i(6810699),c=e.i(3758860),d=e.i(9957872),u=e.i(4245131),p=e.i(8161149),m=e.i(5255926),g=e.i(5468328);e.i(8703064);var x=e.i(648779),h=e.i(4325157),f=e.i(1017032),j=e.i(9668517),y=e.i(3584802),v=e.i(109803),b=e.i(57106);function N(e){let{drainType:i}=e,s=(0,j.useTeamSlug)(),a="logs"===i?"logDrain":"traceDrain",{data:n,isLoading:l}=(0,h.useMarketplaceIntegrations)({protocolType:a}),{data:d,isLoading:p}=(0,o.useResourceList)({protocolType:a}),{data:g,isLoading:N}=(0,f.useConfigurations)({type:"provisioning",skipBillingData:!0,skip:!1}),I=(0,r.useMemo)(()=>{if(!n||!d||!g)return[];let e=[];for(let t of n)for(let r of t.products)(0,c.isProtocolSupported)(r,a)&&e.push({product:r,integration:t});return e},[n,d,g,a]);return l||p||N?(0,t.jsx)(u.Description,{title:(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Available products"}),content:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[1,2].map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 p-4 border border-gray-alpha-400 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,t.jsx)(m.Skeleton,{width:36,height:36,rounded:!0}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)(m.Skeleton,{width:"80%",height:14,className:"mb-2"}),(0,t.jsx)(m.Skeleton,{width:"60%",height:12})]})]}),(0,t.jsx)(m.Skeleton,{width:60,height:32})]},e))})}):0!==I.length&&s?(0,t.jsx)(u.Description,{title:(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Available products"}),content:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:I.map(e=>{let{product:r,integration:i}=e,a=(0,y.getIntegrationCheckoutUrl)({params:{integrationSlug:i.slug,teamSlug:s},searchParams:{productSlug:r.slug,cancelUrl:`${window.location.pathname}${window.location.search}`}});return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 p-4 border border-gray-alpha-400 rounded-lg hover:border-gray-600 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)(x.ProductIcon,{icon:r.iconUrl,size:"large"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"text-sm font-medium truncate",title:r.name,children:r.name}),(0,t.jsx)("div",{className:"text-sm text-gray-600 truncate",title:i.name,children:i.name})]})]}),(0,t.jsx)(b.ButtonLink,{size:"small",type:"secondary",href:a,target:"_blank",rel:"noopener noreferrer",suffix:(0,t.jsx)(v.External,{}),children:"Install"})]},r.id)})})}):null}function I(){let{watch:e,setValue:i}=(0,n.useFormContext)(),s=e("source"),a=e("drainType"),l=s&&"resourceId"in s?s.resourceId??"":"",{data:h,isLoading:f}=(0,o.useResourceList)({protocolType:"traceDrain"}),{data:j,isLoading:y}=(0,o.useResourceList)({protocolType:"logDrain"}),v=(0,r.useMemo)(()=>{let e=[];return"traces"===a&&h?.stores?e.push(...h.stores.filter(e=>(0,c.isProtocolSupported)(e.product,"traceDrain"))):"logs"===a&&j?.stores&&e.push(...j.stores.filter(e=>(0,c.isProtocolSupported)(e.product,"logDrain"))),e},[h,j,a]);if(f||y)return(0,t.jsx)(u.Description,{title:(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Installed products"}),content:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[1,2,3].map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-alpha-400 rounded-lg",children:[(0,t.jsx)(m.Skeleton,{width:40,height:40,rounded:!0}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(m.Skeleton,{width:"80%",height:14,className:"mb-2"}),(0,t.jsx)(m.Skeleton,{width:"60%",height:12})]})]},e))})});let b="logs"===a||"traces"===a;return 0===v.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.EmptyState.Root,{title:"No Integrations Installed",description:"Add an integration that supports drains to get started."}),b&&(0,t.jsx)("div",{className:"flex flex-col gap-6 mt-6",children:(0,t.jsx)(N,{drainType:a})})]}):(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsx)(u.Description,{title:(0,t.jsx)("h2",{className:"text-sm font-medium",children:"Installed products"}),content:(0,t.jsx)(d.ChoiceboxGroup,{type:"radio",label:"Select resource",direction:"row",value:l,onChange:e=>{i("source",{kind:"integration",resourceId:e})},className:"[&>ul]:grid [&>ul]:grid-cols-2 [&>ul]:gap-3 [&_label>div>span:first-child]:overflow-hidden [&_label>div>span:first-child>span]:overflow-hidden",children:v.map(e=>(0,t.jsx)(d.ChoiceboxGroup.Item,{value:e.id,title:(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)(x.ProductIcon,{icon:e.product.iconUrl,size:"large"})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1 overflow-hidden",children:[(0,t.jsx)(g.Tooltip,{text:e.name,className:"block truncate",children:(0,t.jsx)("span",{className:"truncate text-sm font-medium block",children:e.name})}),(0,t.jsxs)("div",{className:"truncate text-sm text-gray-600",title:`${e.product.name}${e.billingPlan?.name?` - ${e.billingPlan.name}`:""}`,children:[e.product.name,e.billingPlan?.name?` - ${e.billingPlan.name}`:""]})]})]})},e.id))})}),b&&(0,t.jsx)(N,{drainType:a})]})}var w=e.i(7609806),S=e.i(1282571);function T(e){let{protocolType:r,limit:i=3,size:s=20}=e,{data:a,isLoading:n,error:l}=(0,h.useMarketplaceIntegrations)({protocolType:r});if(n||l||!a||0===a.length)return null;let o=a.map(e=>({uid:e.id,component:(0,t.jsx)(S.MarketplaceIntegrationCardIcon,{icon:e.icon,name:e.name,size:s})}));return(0,t.jsx)(w.AvatarGroup,{members:o,size:s,limit:i})}function C(e,r){if(r)return null;let i="logs"===e?"logDrain":"traces"===e?"traceDrain":null;return i?(0,t.jsx)(T,{protocolType:i}):null}e.s(["configureDestinationStep",0,{title:"Configure the destination",component:function(){let{watch:e,setValue:o}=(0,n.useFormContext)(),c=e("source"),d=e("mode"),u=e("drainType"),p=(0,r.useMemo)(()=>c?.kind==="integration"?"native-integrations":"custom",[c]),m=C(u,!1);return"update"===d&&c?.kind!=="integration"||"logs"!==u&&"traces"!==u?(0,t.jsx)(l.CustomEndpointEditor,{}):(0,t.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial pt-4 max-w-2xl",children:[(0,t.jsx)(i.Tabs,{selected:p,setSelected:e=>{"native-integrations"===e?o("source",{...c,kind:"integration"}):o("source",{...c,kind:"self-served"})},tabs:[{title:"Custom Endpoint",value:"custom",icon:(0,t.jsx)(s.Terminal,{size:16})},{title:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:["Native Integrations",m]}),value:"native-integrations",icon:(0,t.jsx)(a.LogoVercelFill,{size:16})}]}),"custom"===p?(0,t.jsx)(l.CustomEndpointEditor,{}):(0,t.jsx)(I,{})]})},getFieldsToValidate:e=>e.source?.kind==="integration"?["source","source.resourceId"]:["delivery.endpoint","delivery.encoding","delivery.headers","source"],getIsNextEnabled:e=>e.source?.kind!=="integration"||!!("resourceId"in e.source&&e.source.resourceId),getSuffix:C}],4576858);var k=e.i(9722978),_=e.i(2504781),E=e.i(4030453);e.s(["StepWrapper",0,function(e){let{children:r,onNext:i,onBack:s,isFirstStep:a=!1,isLastStep:n=!1,nextLabel:l="Next",isLoading:o=!1,isNextDisabled:c=!1,error:d}=e;return(0,t.jsxs)(t.Fragment,{children:[r,(0,t.jsxs)("div",{className:`flex flex-row items-stretch justify-start gap-2 flex-initial ${(0,k.default)(!n&&"pb-6")}`,children:[!a&&(0,t.jsx)(_.Button,{onClick:s,type:"secondary",typeName:"button",children:"Back"}),i&&(0,t.jsx)(_.Button,{loading:o,disabled:c,onClick:i,typeName:"button",children:l})]}),d&&n&&(0,t.jsx)(E.Error,{children:d})]})}],3226981);var D=e.i(5298575),$=e.i(9979783),A=e.i(5338940),z=e.i(319451),P=e.i(6060673);e.s(["useCreateDrain",0,function(e,t){let{team:r}=(0,A.useTeam)(),{data:i}=(0,P.useProject)(t),s=(0,z.getDrainsKey)({teamIdOrSlug:e,projectIdOrSlug:t,includeMetadata:!0}),{trigger:a,isMutating:n}=(0,D.default)(s,async(e,t)=>{let{arg:s}=t;if(!r?.id)throw Error("Team ID is required");let a={teamId:r.id,...i&&{projectId:i.id}};return(await (0,$.typedFetch)("/v1/drains","post",a,s,{throwOnHTTPError:!0})).body},{throwOnError:!0});return{createDrain:a,isCreating:n}}],4758962)},8404074,e=>{"use strict";var t=e.i(5298575),r=e.i(3657238),i=e.i(9979783),s=e.i(5338940),a=e.i(319451);e.s(["useUpdateDrain",0,function(e,n){let{team:l}=(0,s.useTeam)(),o=(0,a.getDrainsKey)({teamIdOrSlug:e,projectIdOrSlug:n,includeMetadata:!0}),{trigger:c,isMutating:d,error:u}=(0,t.default)(o,async(e,t)=>{let{arg:s}=t;if(!l?.id)throw Error("Team ID is required");let{id:a,...n}=s;(0,r.mutate)(o,e=>{if(e)return{...e,drains:e.drains.map(e=>e.id===a?{...e,...(e=>{let t={};for(let[r,i]of Object.entries(e))t[r]=null===i?void 0:i;return t})(n)}:e)}},!1);try{let e=await (0,i.typedFetch)("/v1/drains/{id}","patch",{id:a,teamId:l.id},n,{throwOnHTTPError:!0});if((0,r.mutate)(o),200!==e.status)throw console.error("Failed to update drain:",e.body),Error("Failed to update drain");return e.body}catch(e){throw console.error("Failed to update drain:",e),(0,r.mutate)(o),e}},{throwOnError:!0});return{updateDrain:c,isUpdating:d,error:u}}])},3199886,e=>{"use strict";var t=e.i(4205214),r=e.i(8660982),i=e.i(2504781),s=e.i(455575),a=e.i(5806401),n=e.i(6942035),l=e.i(6318858),o=e.i(109803),c=e.i(7694836),d=e.i(9412123),u=e.i(6143247),p=e.i(2199694),m=e.i(7662235),g=e.i(3614887),x=e.i(4576858),h=e.i(3226981),f=e.i(4758962),j=e.i(8404074),y=e.i(3456281);function v(e){let{filters:t}=e;if(!t)return;let r=t?.deployment?.environments?.length>0,i=t?.log?.sources?.length>0;if(i||r)return{version:"v2",filter:{type:"basic",...i?{log:t.log}:{},...r?{deployment:t.deployment}:{}}}}var b=e.i(6818658),N=e.i(3196486),I=e.i(7917902),w=e.i(4789955),S=e.i(8249103),T=e.i(1094129),C=e.i(9572009),k=e.i(4110479);e.i(8703064);var _=e.i(648779);function E(e){let{drain:l,onClose:C,teamSlug:E,projectIdOrSlug:$,onDrainCreated:A,onDrainUpdated:z,onOpenExternalModal:P,drainType:L,defaultProjectId:O}=e,M=l?"update":"create",R=(0,s.useToasts)(),F=L?2:1,[U,B]=(0,r.useState)(F),{validateEndpoint:G}=(0,w.useEndpointValidationContext)(),V=(0,k.useOptionalDrainModalContext)(),q=V?.resource,H=(0,c.useForm)({resolver:(0,d.zodResolver)(T.DrainFormSchema),defaultValues:async()=>{let e,t,r;if("update"!==M||!l)return(e=>{let{secret:t,resourceId:r,drainType:i,projectId:s}=e;return{mode:"create",name:"",...s?{projectIds:[s],projects:"some"}:{projects:"all",projectIds:[]},drainType:i,filters:{log:{sources:[]},deployment:{environments:[]}},delivery:r?void 0:{type:"http",endpoint:"",encoding:"json",secret:t,headers:{},compression:void 0},sampling:[],source:r?{kind:"integration",resourceId:r}:{kind:"self-served"}}})({secret:await (0,S.generateSecret)(32),resourceId:q?.id,drainType:L,projectId:O});return e=function(e){if(!e)return{log:{sources:[]},deployment:{environments:[]}};if("v2"===e.version)if("basic"===e.filter.type)return{log:{sources:e.filter.log?.sources||[]},deployment:{environments:e.filter.deployment?.environments||[]}};else return{log:{sources:[]},deployment:{environments:[]}};throw Error("Unsupported filter version")}(l.filterV2),t=(0,y.getDrainTypeFromDrain)(l),r=l.source?.kind==="integration"?void 0:l.delivery?.type==="http"||l.delivery?.type==="otlphttp"?l.delivery:void 0,{mode:"update",name:l.name??"",projects:l.projectAccess.access,projectIds:"some"===l.projectAccess.access?l.projectAccess.projectIds:void 0,drainType:t,filters:e,delivery:r,sampling:l.sampling,source:l.source}}}),W=(0,r.useCallback)(()=>{C(),H.reset(),B(F)},[C,H,F]),{handleSubmit:Y,isLoading:K}=function(e){let{teamSlug:t,projectIdOrSlug:i,drainId:s,onSuccess:a,onError:n,onDrainCreated:l}=e,{team:o,user:c}=(0,I.useAccount)(),{createDrain:d,isCreating:u}=(0,f.useCreateDrain)(t,i),{updateDrain:m,isUpdating:g}=(0,j.useUpdateDrain)(t,i);return{handleSubmit:(0,r.useCallback)(async e=>{try{if((0,p.isCreateFlow)(e)){let t={name:e.name.trim(),projects:e.projects,projectIds:e.projectIds,...e.delivery&&{delivery:e.delivery},sampling:e.sampling,schemas:(0,y.getSchemaForDrainType)(e.drainType),filter:v({filters:e.filters}),...e.source&&{source:e.source}},r=await d(t);l?.(e,r)}else if((0,p.isUpdateFlow)(e)){if(!s)throw Error("Drain ID is required for update mode");let t={id:s,...void 0!==e.name&&{name:e.name.trim()},...void 0!==e.status&&{status:e.status},...void 0!==e.delivery&&{delivery:e.delivery},...void 0!==e.sampling&&{sampling:e.sampling},...void 0!==e.filters&&{filter:v({filters:e.filters})},...(void 0!==e.projectIds||void 0!==e.projects)&&{projectIds:e.projectIds,projects:e.projects}};await m(t),e.status&&(0,N.sendToSnowflake)(b.Topic.VercelAppV0LogDrainToggle,{event_time:Date.now(),user_id:null!==c?c.uid:"",team_id:null!==o?o.id:"",log_drain_id:s,enabled:"enabled"===e.status},"vercel-app")}a?.()}catch(e){n?.(e)}},[d,m,s,t,i,a,n,o,c,l]),isLoading:u||g}}({teamSlug:E,projectIdOrSlug:$,drainId:l?.id,onSuccess:async()=>{"update"===M&&await z?.(),W(),R.success({text:`Drain ${"create"===M?"created":"updated"} successfully.`,key:`${"create"===M?"add":"edit"}-drain`})},onError:e=>{console.error(e),H.setError("root.serverError",{message:e.message}),R.error({text:`Failed to ${M} drain`})},onDrainCreated:e=>{A?.({drainType:e.drainType,kind:e.source?.kind==="integration"?`integration${"externalResourceId"in e.source?"-external":""}`:e.source?.kind})}}),J=(0,r.useCallback)(async e=>{if(H.clearErrors(),(0,p.isCreateFlow)(e))await Y(e);else if(H.formState.isDirty&&Object.keys(H.formState.dirtyFields).length>0){var t;let r,i,s=(t=H.formState.dirtyFields,r=t.projects||t.projectIds,i=Object.keys(t).reduce((r,i)=>t[i]?{...r,[i]:e[i]}:r,{}),r?{...i,projects:e.projects,projectIds:e.projectIds}:i);await Y({...s,mode:"update",drainType:e.drainType})}else W(),R.success({text:"No changes to save.",key:"edit-drain"})},[Y,H.formState.isDirty,H.formState.dirtyFields,R,W,H.clearErrors,A,l]),Q=(0,r.useMemo)(()=>{let e=[m.chooseDrainDataStep,g.configureDrainStep,x.configureDestinationStep],t=[g.configureDrainStep,x.configureDestinationStep];return q&&(e=[m.chooseDrainDataStep,g.configureDrainStep],t=[g.configureDrainStep]),("update"===M?t:e).map((e,t)=>({...e,id:t+1,number:t+1,isComplete:t+1<U,isActive:U===t+1,disabled:t+1>U}))},[M,U,q]),Z=Q.length,X=Q.find(e=>e.id===U),ee=async()=>{let e=H.getValues(),t=X?.getFieldsToValidate(e);if(!t)return;let r=await H.trigger(t),i=e.source?.kind==="self-served";if(r&&X?.component===x.configureDestinationStep.component)if(i){if(H.setValue("source",{kind:"self-served"}),!await G(e)){let t="string"==typeof e.delivery?.endpoint?"delivery.endpoint":"delivery.endpoint.traces";H.setError(t,{message:""});return}}else H.setValue("delivery",void 0);r&&(U===Z?H.handleSubmit(J,e=>{console.error("[DrainModal] RHF validation failed with errors:",e)})():U<Z&&B(U+1))},et=()=>{U>1&&(H.clearErrors(),B(U-1))};return(0,t.jsxs)("main",{className:"flex h-full shrink-0 grow-0 flex-col",children:[(0,t.jsx)("header",{className:"sticky top-0 z-50 bg-background-100 pt-7",children:(0,t.jsxs)("section",{className:"flex items-center justify-start gap-4 px-8",children:[(0,t.jsxs)(a.SheetTitle,{className:"text-heading-24 flex items-center gap-4",children:[(0,t.jsxs)("span",{children:["create"===M?"Add":"Edit"," Drain"]}),q&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[(0,t.jsx)(_.ProductIcon,{icon:q.product.iconUrl,size:"medium"}),(0,t.jsx)("span",{children:q.name})]})]}),(0,t.jsx)(a.SheetDescription,{className:"sr-only",children:"Configure a drain to send your data to external services"}),(0,t.jsxs)("div",{className:"ml-auto flex items-center gap-3",children:["create"===M&&!q&&P&&(0,t.jsx)(i.Button,{type:"tertiary",size:"small",onClick:P,suffix:(0,t.jsx)(o.External,{}),className:"!text-gray-600 hover:!text-gray-900",children:"External Integrations"}),(0,t.jsx)(i.Button,{svgOnly:!0,"aria-label":"close modal",shape:"circle",size:"tiny",onClick:W,className:"!border-0 !bg-transparent",children:(0,t.jsx)(n.Cross,{color:"gray-1000"})})]})]})}),(0,t.jsx)("div",{className:"px-8 pb-4 pt-6",children:(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)(c.FormProvider,{...H,children:(0,t.jsx)("form",{onSubmit:e=>{e.preventDefault(),ee()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ee())},children:Q.map(e=>{let r=e.getSuffix?.(H.watch("drainType"),e.isActive);return(0,t.jsxs)("div",{children:[(0,t.jsx)(D,{step:e,onClick:()=>{var t;(t=e.number)>U||(H.clearErrors(),B(t))},suffix:r}),e.isActive&&(0,t.jsx)("div",{className:`flex flex-col items-stretch justify-start gap-6 flex-initial ${(0,u.cn)("pl-6 ml-[1.6rem] -mt-1 -mb-1",e.number!==Z&&"border-gray-400 border-dashed border-l")}`,children:(()=>{var e,r,i;if(!X)return null;let s=X.component,a=X.getIsNextEnabled(H.getValues());return(0,t.jsx)(h.StepWrapper,{error:H.formState.errors.root?.serverError?.message,isLoading:K,onNext:ee,onBack:et,isFirstStep:1===U,isLastStep:U===Z,nextLabel:(e=U,r=Z,i=M,e===r?"create"===i?"Create Drain":"Update Drain":"Next"),isNextDisabled:!a,children:(0,t.jsx)(s,{})})})()})]},e.number)})})})})})]})}function D(e){let{step:r,onClick:i,suffix:s}=e;return(0,t.jsxs)("div",{className:(0,u.cn)("flex items-center gap-3 px-3 py-3 cursor-pointer transition-colors",{"hover:bg-gray-50":!r.disabled&&!r.isActive,"opacity-80 cursor-not-allowed":r.disabled&&r.isNext,"opacity-50 cursor-not-allowed":r.disabled&&!r.isNext,"hover:bg-success-100":r.isComplete&&!r.isActive}),onClick:i,title:r.isComplete&&!r.isActive?"Click to return to this step":void 0,children:[(0,t.jsx)("div",{className:(0,u.cn)("flex size-7 items-center justify-center rounded-full text-sm font-medium border",{"bg-success text-black border-success":r.isComplete,"bg-black text-white border-black":!r.isComplete&&r.isActive,"bg-white text-gray-900 border-gray-500":!r.isComplete&&!r.isActive}),children:r.isComplete?(0,t.jsx)(l.Check,{size:14}):r.number}),(0,t.jsx)("p",{className:(0,u.cn)("text-[16px] leading-[24px]",r.isActive&&"font-medium"),children:r.title}),s]})}e.s(["DrainModal",0,function(e){let{drain:i,active:s,onClose:n,teamSlug:l,projectIdOrSlug:o,onDrainCreated:c,onDrainUpdated:d,onOpenExternalModal:p,drainType:m,defaultProjectId:g}=e,x=(0,r.useRef)(null);return(0,t.jsx)(a.Sheet,{open:s,onOpenChange:e=>!e&&n(),children:(0,t.jsx)(a.SheetContent,{ref:x,className:(0,u.cn)("m-3 h-[calc(100%-1.5rem)] w-[calc(100%-1.5rem)] overflow-y-auto rounded-[1rem] bg-white p-0 pb-6 lg:w-3/4 sm:max-w-[800px]"),side:"right",children:(0,t.jsx)(C.SheetContainerContext.Provider,{value:x.current,children:(0,t.jsx)(w.EndpointValidationProvider,{children:(0,t.jsx)(E,{drain:i,onClose:n,teamSlug:l,projectIdOrSlug:o,onDrainCreated:c,onDrainUpdated:d,onOpenExternalModal:p,drainType:m,defaultProjectId:g})})})})})}],3199886)},5765731,e=>{"use strict";var t=e.i(2704354),r=e.i(9668517),i=e.i(850302);e.s(["useConnectableIntegrations",0,function(){let e=(0,r.useTeamSlug)();return(0,i.default)(e?(0,t.getMarketplaceIntegrationsApiUrl)({integrationType:"external",teamIdOrSlug:e}):null,e=>fetch(e).then(e=>e.json()))}])},7908739,e=>{"use strict";e.s(["HIDE_ADD_BUTTON_SLUGS",0,["bigcommerce"],"HIDE_DEPLOY_BUTTON_SLUGS",0,["agility-cms","gel","motherduck"]])},6269556,e=>{"use strict";var t=e.i(5677444),r=e.i(8660982),i=e.i(6838069);e.s(["useMarketplaceNavigation",0,function(){let e=(0,t.useSearchParams)(),s=(0,t.useParams)(),a=e?.get("category")??null,n=e?.get("search")??null,l=!!e?.get("expanded"),o=!!e?.get("isPreview"),c=(0,r.useMemo)(()=>s?.teamSlug?{teamSlug:s.teamSlug.toString(),isPublic:!1}:{isPublic:!0,teamSlug:void 0},[s?.teamSlug]);return{categorySlug:a,isRootCategory:!a||!!l,searchQuery:n,expanded:l,teamSlugOrPublic:c,isPreview:!!o,getBrowseMarketplaceLink:e=>(0,i.getBrowseMarketplaceLink)({teamSlugOrPublic:c,...e})}}])},6315360,e=>{e.v({bradcrumbsWrapper:"details-layout-module__xg7Djq__bradcrumbsWrapper",breadcrumbsText:"details-layout-module__xg7Djq__breadcrumbsText",cta:"details-layout-module__xg7Djq__cta",header:"details-layout-module__xg7Djq__header",marketplaceDetailsProductsGrid:"details-layout-module__xg7Djq__marketplaceDetailsProductsGrid",marketplaceProduct:"details-layout-module__xg7Djq__marketplaceProduct",message:"details-layout-module__xg7Djq__message",mobileHeaderButtons:"details-layout-module__xg7Djq__mobileHeaderButtons",wrapper:"details-layout-module__xg7Djq__wrapper"})},1033832,e=>{"use strict";var t=e.i(4205214),r=e.i(5468328),i=e.i(4991687),s=e.i(6694387),a=e.i(8459493),n=e.i(8674454),l=e.i(8876434),o=e.i(57106),c=e.i(8660982),d=e.i(5338940),u=e.i(1857939),p=e.i(2504781),m=e.i(3225905),g=e.i(7668531),x=e.i(2704354),h=e.i(7908739),f=e.i(6838069),j=e.i(1017032),y=e.i(8794163),v=e.i(4065455),b=e.i(6269556),N=e.i(7594446),I=e.i(6315360),w=e.i(9722978);let S={normal:{foreground:"#000",background:"#fff",border:"#fff"},hover:{foreground:"#fff",background:"#000",border:"#fff"},active:{foreground:"#fff",background:"#000",border:"#fff"}};function T(e){let{isCta:r,...i}=e;return r?(0,t.jsx)(g.CustomButtonLink,{...S,...i}):(0,t.jsx)(o.ButtonLink,{...i})}function C(e){let{isCta:r,...i}=e;return r?(0,t.jsx)(m.CustomButton,{...S,...i}):(0,t.jsx)(p.Button,{...i})}function k(e){let{integration:i,isCta:s,type:a,size:n,className:l,loginRedirect:o}=e,{isLoggedOut:p}=(0,u.useIsLoggedIn)(),{teamSlugOrPublic:m}=(0,b.useMarketplaceNavigation)(),{canCreateIntegrationConfiguration:g}=(0,N.useIntegrationPermissions)(),h=a??((0,x.isMarketplaceIntegration)(i)?"secondary":"default"),{isReady:I,team:w}=(0,d.useTeam)(),{hasConfigurations:S,data:k}=(0,j.useConfigurations)({integrationId:i.id,type:"external",skip:m.isPublic,skipBillingData:!0}),_=k?.[0],[E,D]=(0,c.useState)(!1),$=!!(w?.billing?.plan==="hobby"||w?.billing?.trial)&&i.proOnly,A=!g,z=$||A,P=!!(0,y.useV0Marketplace)()?.token;if((0,x.isMarketplaceOnlyIntegration)(i))return null;let L=!i.canInstall&&!!i.hiddenAt;return _&&m.teamSlug?(0,t.jsx)(r.Tooltip,{disableTriggers:g,text:g?void 0:"You don't have permission to manage this integration.",children:(0,t.jsx)(T,{className:l,href:(0,f.getInstallationDetailsLink)({teamSlug:m.teamSlug,configurationId:_.id,integrationSlug:i.slug,isMarketplace:!1}),isCta:s,type:h,size:n,disabled:!g,children:"Manage"})}):L?null:p?(0,t.jsx)(T,{className:l,disabled:(0,x.isLegacyIntegration)(i),href:o??`/login?next=${(0,f.getIntegrationDetailsLink)({integrationSlug:i.slug,teamSlugOrPublic:m,isFromV0:P})}`,isCta:s,type:h,size:n,rel:"nofollow",children:"Connect Account"}):(0,t.jsxs)(t.Fragment,{children:[S?null:(0,t.jsx)(r.Tooltip,{disableTriggers:!z,text:A?"You need additional permissions to install integrations.":"You need a paid account to install this integration",children:(0,t.jsx)(C,{className:l,disabled:z,isCta:s,onClick:()=>D(!0),type:h,size:n,children:"Connect Account"})}),E&&I?(0,t.jsx)(v.InstallExternalIntegrationModal,{account:w,integration:i,onAnimationDone:()=>D(!1),teamSlugOrPublic:m}):null]})}e.s(["ConnectAndTemplateMenu",0,function(){let{size:e,integrationSlug:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r&&h.HIDE_DEPLOY_BUTTON_SLUGS.includes(r)?null:(0,t.jsxs)(i.MenuContainer,{children:[(0,t.jsx)(s.MenuButton,{"aria-label":"More",shape:"square",svgOnly:!0,type:"secondary",size:e,children:(0,t.jsx)(l.MoreHorizontal,{})}),(0,t.jsx)(n.Menu,{children:(0,t.jsx)(a.MenuItem,{children:(0,t.jsx)(o.Link,{href:"#template",prefetch:!1,children:"Deploy Template"})})})]})},"ConnectExternalIntegrationButton",0,k,"ConnectExternalIntegrationCTA",0,function(e){let{integration:r}=e,{teamSlugOrPublic:i}=(0,b.useMarketplaceNavigation)(),{hasConfigurations:s}=(0,j.useConfigurations)({integrationId:r.id,type:"external",skip:i.isPublic,skipBillingData:!0}),a=!r.canInstall&&!!r.hiddenAt;return s||a?null:(0,t.jsx)("div",{className:I.default.wrapper,children:(0,t.jsxs)("div",{className:(0,w.default)("flex flex-col items-stretch justify-start gap-3 flex-initial",I.default.cta),children:[(0,t.jsxs)("div",{className:I.default.message,children:["Get started with Vercel and ",r.name,"."]}),(0,t.jsx)(k,{integration:r,isCta:!0})]})})}])},7589392,e=>{"use strict";var t=e.i(4205214),r=e.i(8660982),i=e.i(3199886),s=e.i(6891161),a=e.i(57106),n=e.i(109803),l=e.i(1017032),o=e.i(5765731),c=e.i(2521731),d=e.i(2704354),u=e.i(1282571),p=e.i(1033832),m=e.i(7743427);function g(e){let{config:r,teamSlug:i}=e,{data:s,isLoading:l}=(0,m.useIntegration)(r.integrationId,{teamId:i});return l||!s?null:(0,t.jsx)(u.MarketplaceIntegrationCard,{Actions:(0,t.jsx)(a.ButtonLink,{size:"small",type:"secondary",prefix:(0,t.jsx)(n.External,{size:14}),href:(0,d.getConfigureUrl)(s,r.id),target:"_blank",children:"Configure"}),className:"p-3 px-4",disabled:!0,href:"#",icon:s.icon,title:s.name,children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-1000",children:s.name}),(0,t.jsxs)("div",{className:"text-xs text-gray-900",children:["Connected ",new Date(r.createdAt).toLocaleDateString()]})]})})}function x(e){let{teamSlug:r,onClose:i}=e,{data:a}=(0,l.useConfigurations)({skipBillingData:!0}),{data:n}=(0,o.useConnectableIntegrations)(),d=a?.filter(e=>"external"===e.installationType&&e.scopes.includes("read-write:log-drain"))||[],m=Array.isArray(n)?n.filter(e=>!!(0,c.integrationSupportsLogDrains)(e)&&!a?.some(t=>"external"===t.installationType&&t.integrationId===e.id)):[];return(0,t.jsxs)(s.Modal.Modal,{active:!0,onClickOutside:i,children:[(0,t.jsxs)(s.Modal.Body,{children:[(0,t.jsx)(s.Modal.Header,{children:(0,t.jsx)(s.Modal.Title,{center:!0,children:"External Integration Log Drains"})}),(0,t.jsxs)("div",{className:"flex flex-col gap-6 mt-4",children:[d.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-1000 mb-3",children:"Installed Integrations"}),(0,t.jsx)("div",{className:"rounded-md border border-accents-2 shadow-[0px_1px_2px_0px_rgba(0,0,0,0.04)]",children:d.map(e=>(0,t.jsx)(g,{config:e,teamSlug:r},e.id))})]}),m.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-gray-1000 mb-3",children:"Available Integrations"}),(0,t.jsx)("div",{className:"rounded-md border border-accents-2 shadow-[0px_1px_2px_0px_rgba(0,0,0,0.04)]",children:m.map(e=>(0,t.jsx)(u.MarketplaceIntegrationCard,{Actions:(0,t.jsx)(p.ConnectExternalIntegrationButton,{integration:e,size:"small"}),className:"p-3 px-4",disabled:!0,href:"#",icon:e.icon,title:e.name,children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-1000",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-gray-900",children:e.shortDescription})]})},e.id))})]}),0===d.length&&0===m.length&&(0,t.jsx)("p",{className:"text-center py-8 text-gray-700",children:"No external integrations available for log drains."})]})]}),(0,t.jsxs)(s.Modal.Actions,{children:[(0,t.jsx)("div",{}),(0,t.jsx)(s.Modal.Action,{type:"secondary",onClick:i,children:"Close"})]})]})}var h=e.i(8633387);e.s(["DrainModals",0,function(e){let{isOpen:s,closeModal:a,teamSlug:n,projectIdOrSlug:l,onDrainCreated:o,drain:c,drainType:d}=e,[u,p]=(0,r.useState)(!1),{data:m}=(0,h.useDashboardProject)({projectSlug:l,teamSlug:n});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.DrainModal,{drain:c,active:s,onClose:()=>{a()},teamSlug:n,projectIdOrSlug:l,onDrainCreated:o,onOpenExternalModal:()=>{a(),p(!0)},drainType:d,defaultProjectId:m?.id},c?.id),u&&(0,t.jsx)(x,{teamSlug:n,onClose:()=>p(!1)})]})}],7589392)}]);

//# debugId=b1e0ca32-9840-ff5d-0788-2bc7b241b722
//# sourceMappingURL=22418a3dd637534d.js.map